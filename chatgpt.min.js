const GPT_BASE_URL="https://api.openai.com";async function get_request(t,o){return await(await fetch(""+GPT_BASE_URL+t,{headers:{Authorization:"Bearer "+o.getToken(),"Content-Type":"application/json","OpenAI-Organization":o.getOrg()}})).json()}async function post_request(t,o,e){return await(await fetch(""+GPT_BASE_URL+t,{method:"POST",headers:{Authorization:"Bearer "+o.getToken(),"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}function GPTAccount(t,o,e){this.org=t,this.token=o,this.default_model=e}async function loadGPTAccountFromStorage(){var t=await chrome.storage.sync.get(["org","token","default_model"]);return new GPTAccount(t.org||"",t.token||"",t.default_model||"")}function GPTChat(t,o,e,n){this.account=t,this.model=o||t.getDefaultModel()||"gpt-3.5-turbo",this.history=e||[],this.tokenUsages=n||[]}GPTAccount.prototype.getOrg=function(){return this.org},GPTAccount.prototype.getToken=function(){return this.token},GPTAccount.prototype.getDefaultModel=function(){return this.default_model},GPTAccount.prototype.getModels=async function(){var t=await get_request("/v1/models",this);return t.data?(t.data.sort((t,o)=>t.id.localeCompare(o.id)),t.data):[]},GPTAccount.prototype.saveToStorage=async function(){await chrome.storage.sync.set({org:this.org,token:this.token,default_model:this.default_model||""})},GPTChat.prototype.getHistory=function(){return this.history},GPTChat.prototype.getTokenUsages=function(){return this.tokenUsages},GPTChat.prototype.getModel=function(){return this.model},GPTChat.prototype.getTokenSummary=function(){return this.tokenUsages.reduce((t,o)=>({total_tokens:t.total_tokens+o.total_tokens,prompt_tokens:t.prompt_tokens+o.prompt_tokens,completion_tokens:t.completion_tokens+o.completion_tokens}),{total_tokens:0,prompt_tokens:0,completion_tokens:0})},GPTChat.prototype.ask=async function(t,o,e){this.history.push({role:o&&o.user||"user",content:t}),e&&e(this);t=await post_request("/v1/chat/completions",this.account,{...o,model:this.model,messages:this.history}),e=t.choices[0].message.content,o=t.choices[0].message.role;this.history.push({role:o,content:e}),this.tokenUsages.push({total_tokens:t.choices[0].tokens,prompt_tokens:t.choices[0].prompt_tokens,completion_tokens:t.choices[0].completion_tokens})},console.log("ChatGPT.js loaded.");